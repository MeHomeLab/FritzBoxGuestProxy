## Background

So I got a cheap usb fi´´wifi dongle.
The **TP-Link AC600 (Archer T2U Nano)** —  **Realtek RTL8811AU** chipset.
The same process should apply to other Realtek 8811/8821 series adapters.

Originally, I wanted to integrate this device directly into my **OPNsense**, but the driver instability made that idea... optimistic. Adjusting the power mode helped a bit. Well here were are, it's an ubuntu vm now.  

Unlike 24, Ubuntu 25 ships with kernel 6.14 by default, and this chipset only behaves correctly with **kernel ≥ 6.14** drivers, i run 6.16, for now no bigger issues.

---

## System Requirements

- Ubuntu 25 (or another modern Debian-based distro)
- Linux **kernel 6.14 or newer**
- Internet access (Ethernet or temporary network)
- Administrator privileges (`sudo`)

---

## Installation Procedure

### 1️⃣ Install and Upgrade to Kernel 6.14+

```bash
# Ensure NetworkManager is available
sudo apt install -y network-manager

# Required tools
sudo apt install -y software-properties-common pkexec

# Add PPA for 'mainline' kernel installer
sudo add-apt-repository ppa:cappelikan/ppa -y
sudo apt update
sudo apt install -y mainline

# List available kernels and install 6.14.x
sudo mainline --list
sudo mainline --install 6.14.1

# Reboot into the new kernel
sudo reboot
```

After reboot, verify:

```bash
uname -r
# Expected output: 6.14.x-something
```

If you’re still on an older kernel, run mainline --install 6.14.1 again and confirm the GRUB selection.

2️⃣ Firmware Installation and Verification
The required firmware files for this Realtek chipset live in /lib/firmware/rtw88/.

```bash
# Install or refresh firmware package
sudo apt install -y linux-firmware
sudo apt --reinstall install linux-firmware
```
Check for presence of the expected binaries:
```bash
ls -l /lib/firmware/rtw88/rtw8821a_*.bin
```
You should see at least:

```bash
/lib/firmware/rtw88/rtw8821a_fw.bin
/lib/firmware/rtw88/rtw8821a_wowlan.bin
```

If they are missing, fetch them manually:

```bash
sudo mkdir -p /lib/firmware/rtw88
sudo curl -L -o /lib/firmware/rtw88/rtw8821a_fw.bin \
  https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/plain/rtw88/rtw8821a_fw.bin
sudo curl -L -o /lib/firmware/rtw88/rtw8821a_wowlan.bin \
  https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/plain/rtw88/rtw8821a_wowlan.bin
```

Then reload the module:

```bash
sudo modprobe -r rtw88_8821au 2>/dev/null || true
sudo modprobe rtw88_8821au
# Or better reboot 
sudo reboot 0
```

If you see no kernel errors in dmesg | tail, you’re in good shape.

3️⃣ Connect to Wi-Fi
List available access points:

```bash
nmcli dev wifi list
```
Connect interactively (NetworkManager will prompt for password):

```bash
sudo nmcli dev wifi connect 'FRITZ!Box Gastzugang' --ask
```
The adapter will typically appear as an interface similar to:

```nginx
wlan0
```
You can verify its state:

```bash
nmcli dev status
iw dev

```
Optional: disable power saving if you experience random disconnects:

```bash
sudo iw dev wlan0 set power_save off
```

# Troubleshooting
Symptom	Possible Cause	Resolution
Adapter not detected	Missing kernel module	Ensure rtw88_8821au is loaded **lsmod**
Connects once, then drops	Power save bug	Disable power management as shown above
dmesg full of rtw errors	Firmware mismatch	Reinstall firmware from linux-firmware or kernel.org
No interface at all	Wrong kernel	Confirm you are running ≥ 6.14 (uname -r)

# Notes and Observations
Power management defaults are aggressive on Realtek chipsets — disabling them usually helps maintain a stable link.

The module name for this chipset under modern kernels is rtw88_8821au (not to be confused with older 8812au out-of-tree drivers).

Works reliably inside an Ubuntu VM with USB passthrough.

Closing Thoughts
Do not send the stick back, can be debuged